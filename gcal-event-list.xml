<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <!--http://gcal-event-list.googlecode.com/svn/trunk/gcal-event-list.xml-->
  <ModulePrefs title="gcal-event-list"/>
  <UserPref name="calendarid" display_name="Google Calendar Id" required="true" />
  <UserPref name="apikey" display_name="Google Calendar API Key" required="true"/>
  <UserPref name="cssclass1" display_name="css class associated with ul tag" required="true" />
  <UserPref name="cssclass2" display_name="css class associated with li tag (date)" required="true" />
  <UserPref name="cssclass3" display_name="css class associated with li tag (description)" required="true" />
  <Content type="html">
    <![CDATA[
    <div id="content_div"></div>
    <script type="text/javascript">

    function makeJSONRequest() {    
      var params = {};
      params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
      // This URL returns a JSON-encoded string that represents a JavaScript object
      
      var prefs = new gadgets.Prefs();
      var calendarid = prefs.getString("calendarid");
      var apikey = prefs.getString("apikey");
      var url = "https://www.googleapis.com/calendar/v3/calendars/" + calendarid + "/events?key=" + apikey ;
      gadgets.io.makeRequest(url, response, params);
    };


    function response(obj) {    
      var jsondata = obj.data;   
      var html = "";
      // Process returned JS object as an associative array
        var value = jsondata["summary"];
        html += value + "<br />";
        html += value + "<div>This gadget is a work in progress : last updated on Apr 2, 2014</div>";
        value = jsondata["items"]
        // Items is an array, render its contents as a bulleted list
        if (value instanceof Array)
        {
          html += "<br /><ul>";
          for (var i = 0; i < value.length ; i++)
          {   
	    var eventDate = new Date(jsondata.items[i].start.dateTime);    
	    html += "<a target=\"_top\" href=\"" + jsondata.items[i].htmlLink + "\"><li>"+ eventDate.toLocaleDateString() + " - " +  jsondata.items[i].summary + "</li></a>";
          }
          html+= "</ul>";
        }  
  
                 
      document.getElementById('content_div').innerHTML = html;
     };
     gadgets.util.registerOnLoadHandler(makeJSONRequest);
     </script>
  ]]>
  </Content>
</Module>